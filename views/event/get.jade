extends ../layout

block content

  //- content header
  div.content_header

    //- title
    h1.title=event.name     

    //- action menu
    div.action_menu
      ul
        li 
          a(href="#download") Download
        li 
          a(href="#slideshow") Slideshow

  //- event details
  div.event
    //-span.title= 
    span.desc= event.desc
    span.dates #{event.start.getFullYear()}.#{event.start.getMonth()}.#{event.start.getDate()} ~ #{event.end.getFullYear()}.#{event.end.getMonth()}.#{event.end.getDate()}
    span.tag &#35;#{event.tag}    

  //- event media
  div.media
    //- if media.length > 0
    //-   each medium in media
    //-     img(src="#{medium.images.thumbnail.url}", rel="#{medium.images.standard_resolution.url}")
    //- else
    //-   div no images at this time

block scripts
  //- layout
  script.
    var eventId = "#{event._id}";
    var lastId = "";

    function refresh(data) {
      var length = data.length;
      for (var i = 0; i < length; i++) {
        $(".media").prepend("<img src='" + data[i].images.thumbnail.url + "' rel='" + data[i].images.standard_resolution.url + "'/>");
      }
      // update last id
      lastId = data[length - 1].id;      
    }

    (function poll() {
      setTimeout(function () {
        $.ajax({
          type: 'GET',
          dataType: 'json',
          url: '/api/events/' + eventId + '/media?from=' + lastId,
          success: function (data) {
            console.log(data);
            // if there's data, refresh grid
            if(data.length > 0) refresh(data);
          },
          complete: poll
        });
      }, 5000);
    })();
